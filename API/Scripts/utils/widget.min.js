var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var widget;(function(widget){var ScrollViewBtnHandler=function(){function ScrollViewBtnHandler(r){this._scrollView=r}ScrollViewBtnHandler.prototype.upDataList=function(){this._arr=new Array;for(var i=0;i<this.getMaxNum();i++){this._arr[i]=new widget.Button;this._arr[i].width=this.getBtnWidth();this._arr[i].height=this.getBtnHight();this._arr[i].txt=this._scrollView.eventShowList[i].name;this._arr[i].txtColor="white";this._arr[i]._btn_bg.src=this._scrollView.scrollBtnImg;this._arr[i]._btn_bg_press.src=this._scrollView.scrollBtnImg_press}};ScrollViewBtnHandler.prototype.getMaxNum=function(){return this._scrollView.eventShowList.length};ScrollViewBtnHandler.prototype.getBtnHight=function(){return this._scrollView.LISTBTN_HEIGHT};ScrollViewBtnHandler.prototype.getBtnWidth=function(){return this._scrollView.LISTBTN_WIDTH};ScrollViewBtnHandler.prototype.getBtn=function(index){var _this=this;this._arr[index].addClickEvent(function(){_this._scrollView.scale=_this._scrollView.eventShowList[index].scale;_this._scrollView.removeListBtn();if(_this._scrollView.listBtnAction){_this._scrollView.listBtnAction(index)}});return this._arr[index]};return ScrollViewBtnHandler}();(function(ScrollViewType){ScrollViewType[ScrollViewType["BIGDATA"]=0]="BIGDATA";ScrollViewType[ScrollViewType["SMALLDATA"]=1]="SMALLDATA"})(widget.ScrollViewType||(widget.ScrollViewType={}));var ScrollViewType=widget.ScrollViewType;var Window=function(_super){__extends(Window,_super);function Window(w,h){var _this=this;_super.call(this);this._titleHeight=30;this._ipen=new iPen(this.canvas);this.onDraw=function(ctx){_this._ipen.readDraw("black",1);ctx.fillStyle="white";ctx.fillRect(0,0,_this.width,_this.height);ctx.rect(0,0,_this.width,_this.height);_this._ipen.drawOver()};this.layout=new widget.EasyLayout(this);this._title=new view.Container;this._box=new view.Container;this._title.height=this._titleHeight;this._close=new Button;this.initBtn(this._close);this._close.width=45;this._big=new Button;this.initBtn(this._big);this._small=new Button;this.initBtn(this._small);var l=new EasyLayout2(this._title);l.float="right";this._title.layout=l;this.height=h+this._titleHeight;this._box.height=h;this._box.width=this.width=this._title.width=w;this._title.addChild(this._close);this._title.addChild(this._big);this._title.addChild(this._small);var offX=0;var offY=0;this._title.addTouchEventListener(function(e){switch(e.touchType){case view.View.DOWN:offX=e.clientX-_this.left;offY=e.clientY-_this.top;break;case view.View.MOVE:_this.left=e.clientX-offX;_this.top=e.clientY-offY;break}return true});this.addChild(this._title);this.addChild(this._box);this._title.upDataLayout();this.upDataLayout()}Object.defineProperty(Window.prototype,"box",{get:function(){return this._box},enumerable:true,configurable:true});Window.prototype.setCloseAction=function(fun){this._close.addClickEvent(fun)};Window.prototype.seTheme=function(title_bg,close_bg,small_bg,big_bg,close_bg_press,small_bg_press,big_bg_press){this._title.setBackGround(title_bg);this._close._btn_bg.src=close_bg;this._close._btn_bg_press.src=close_bg_press;this._big._btn_bg.src=big_bg;this._big._btn_bg_press.src=big_bg_press;this._small._btn_bg.src=small_bg;this._small._btn_bg_press.src=small_bg_press};Window.prototype.initBtn=function(btn){btn.txt="";btn.height=this._title.height-7;btn.width=40};return Window}(view.Container);widget.Window=Window;var EasyLayout2=function(){function EasyLayout2(c){this._margin=0;this.float="right";this.maxWidth=0;this._container=c}Object.defineProperty(EasyLayout2.prototype,"margin",{get:function(){return this._margin},set:function(n){this._margin=n},enumerable:true,configurable:true});EasyLayout2.prototype.floatLeft=function(){var top=this._margin;var left=this._margin;var maxHeight=0;if(this.maxWidth<=0){this.maxWidth=this._container.width}for(var i=0;i<this._container.children.length;i++){if(this._container.children[i].ignoreLayout){continue}if(left+this._container.children[i].width>this.maxWidth){left=this._margin;top+=maxHeight+this._margin*2;maxHeight=this._container.children[i].height}this._container.children[i].top=top;this._container.children[i].left=left;left=this._container.children[i].right+this._margin*2;if(this._container.children[i].height>maxHeight){maxHeight=this._container.children[i].height}}};EasyLayout2.prototype.floatRight=function(){var maxHeight=0;if(this.maxWidth<=0){this.maxWidth=this._container.width}var top=this._margin;var right=this.maxWidth-this._margin;for(var i=0;i<this._container.children.length;i++){if(this._container.children[i].ignoreLayout){continue}if(right-this._container.children[i].width<0){right=this.maxWidth-this._margin;top+=maxHeight+this._margin*2;maxHeight=this._container.children[i].height}this._container.children[i].top=top;this._container.children[i].left=right-this._container.children[i].width;right=this._container.children[i].left-this._margin*2;if(this._container.children[i].height>maxHeight){maxHeight=this._container.children[i].height}}};EasyLayout2.prototype.useLayout=function(){if(this._container.children.length>0){switch(this.float){default:case"left":this.floatLeft();break;case"right":this.floatRight();break}}};return EasyLayout2}();widget.EasyLayout2=EasyLayout2;var EasyLayout=function(){function EasyLayout(c){this.maxHeight=0;this._margin=0;this._container=c}Object.defineProperty(EasyLayout.prototype,"margin",{get:function(){return this._margin},set:function(n){this._margin=n},enumerable:true,configurable:true});EasyLayout.prototype.useLayout=function(){if(this._container.children.length>0){var top=this._margin;var left=this._margin;var maxWidth=0;if(this.maxHeight<=0){this.maxHeight=this._container.height}for(var i=0;i<this._container.children.length;i++){if(this._container.children[i].ignoreLayout){continue}if(top+this._container.children[i].height>=this.maxHeight){top=this._margin;left+=maxWidth+this._margin*2;maxWidth=this._container.children[i].width}this._container.children[i].top=top;this._container.children[i].left=left;top=this._container.children[i].bottom+this._margin*2;if(this._container.children[i].width>maxWidth){maxWidth=this._container.children[i].width}}}};return EasyLayout}();widget.EasyLayout=EasyLayout;var ScrollView=function(_super){__extends(ScrollView,_super);function ScrollView(){var _this=this;_super.call(this);this.type=ScrollViewType.SMALLDATA;this.LISTBTN_HEIGHT=30;this.LISTBTN_WIDTH=60;this._isShowEvents=false;this._scale=0;this._scrollOFF=0;this.eventShowList=[];this.borderColor="blue";this._scrollButton=new view.View;this.height=this._scrollButton.width=this._scrollButton.height=ScrollView.SCROLL_WIDTH;this._pen=new iPen(this.canvas);this._bg=new Image;this._scroll_bg=new Image;this._scroll_bg_press=new Image;this._handler=new ScrollViewBtnHandler(this);this._listButton=new ListButton(this._handler);this.setBackGround(this._bg);this._scrollButton.setBackGround(this._scroll_bg);this.addChild(this._scrollButton);this.bgSRC="lib/img/RulerBg.png";this.scrollbgSRC="lib/img/btn1.png";this.scrollPressbgSRC="lib/img/btn1_press.png";this.scrollBtnImg="lib/img/btn2.png";this.scrollBtnImg_press="lib/img/btn2_press.png";this._scrollButton.addTouchEventListener(function(e){switch(e.touchType){case view.View.DOWN:_this._scrollButton.setBackGround(_this._scroll_bg_press);_this._scrollOFF=e.clientX-_this._scrollButton.left;if(_this.scrollAction){_this.scrollAction(e.touchType,_this._scale)}break;case view.View.MOVE:var left=e.clientX-_this._scrollOFF;left=left<0?0:left>_this.fakeWidth?_this.fakeWidth:left;if(_this.type==ScrollViewType.SMALLDATA){var scale=left/_this.fakeWidth;_this.scale=scale}else{_this._scrollButton.left=left}if(_this.scrollAction){_this.scrollAction(e.touchType,_this._scale)}break;case view.View.UP:_this._scrollButton.setBackGround(_this._scroll_bg);if(_this.type!=ScrollViewType.SMALLDATA){var left=e.clientX-_this._scrollOFF;left=left<0?0:left>_this.fakeWidth?_this.fakeWidth:left;var scale=left/_this.fakeWidth;_this.scale=scale}if(_this.scrollAction){_this.scrollAction(e.touchType,_this._scale)}break}_this._scrollButton.sUpdata();return true});var b=true;this.addTouchEventListener(function(e){if(e.touchType==view.View.DOWN){b=true}if(e.type==view.View.TOUCH_DOWN){var scale=e.offX/_this.fakeWidth;scale=scale<0?0:scale>1?1:scale;_this.eventShowList=[];for(var i=0;i<_this.handler.getMaxNum();i++){var s=_this.handler.getEventScale(i);if(s>scale-.01&&s<scale+.01){var obj={scale:s,name:_this.handler.getEventName(i)};_this.eventShowList.push(obj)}}if(_this.eventShowList.length>0){_this._handler.upDataList();_this._listButton.onCreate();_this._listButton.top=_this.top-_this._listButton.height;var x=e.offX-_this._handler.getBtnWidth()/2;x=x<0?0:x>_this.width-_this._handler.getBtnWidth()?_this.width-_this._handler.getBtnWidth():x;if(!_this._listButton.parent){_this._listButton.left=x;_this.parent.addChild(_this._listButton);b=false}}else{_this.removeListBtn()}}if(b){switch(e.touchType){case view.View.UP:var scale=e.offX/_this.fakeWidth;_this.scale=scale;if(_this.rulerClickAction){_this.rulerClickAction(scale)}break}}_this._scrollButton.sUpdata();return true});this.addFloatMoveEvent(function(e){if(!_this.handler||!_this.isShowEvents){return false}switch(e.touchType){case view.View.MOVE:var scale=e.offX/_this.fakeWidth;scale=scale<0?0:scale>1?1:scale;_this.eventShowList=[];for(var i=0;i<_this.handler.getMaxNum();i++){var s=_this.handler.getEventScale(i);if(s>scale-.01&&s<scale+.01){var obj={scale:s,name:_this.handler.getEventName(i)};_this.eventShowList.push(obj)}}if(_this.eventShowList.length>0){_this._handler.upDataList();_this._listButton.onCreate();_this._listButton.height=_this._handler.getMaxNum()*_this._handler.getBtnHight()+1;_this._listButton.top=_this.top-_this._listButton.height;var x=e.offX-_this._handler.getBtnWidth()/2;x=x<0?0:x>_this.width-_this._handler.getBtnWidth()?_this.width-_this._handler.getBtnWidth():x;if(!_this._listButton.parent){_this._listButton.left=x;_this.parent.addChild(_this._listButton)}}else{_this.removeListBtn()}break}return true});this._listButton.addFloatMoveEvent(function(e){switch(e.touchType){case view.View.FLOAT_END:_this.removeListBtn();break}return true});this.onDraw=function(ctx){if(_this.handler&&_this.isShowEvents){for(var i=0;i<_this.handler.getMaxNum();i++){A:switch(_this.handler.getEventType(i)){case ScrollView.SCROLL_EVENTS_TYPE_LINE:_this._pen.readDraw(_this.handler.getEventColor(i),1);var x=_this.handler.getEventScale(i)*_this.fakeWidth;ctx.moveTo(x,0);ctx.lineTo(x,_this.height);_this._pen.drawOver();break A;case ScrollView.SCROLL_EVENTS_TYPE_RECT:_this._pen.readDraw(_this.handler.getEventColor(i),5);var x=_this.handler.getEventScale(i)*_this.fakeWidth;ctx.moveTo(x,0);ctx.lineTo(x,_this.height/2);ctx.fillStyle=_this.handler.getEventColor(i);ctx.fillRect(x,0,_this.handler.getEventLength(i)*_this.fakeWidth,_this.height/2);_this._pen.drawOver();break A}}}_this._pen.readDraw(_this.borderColor,2);ctx.rect(0,0,_this.width,_this.height);_this._pen.drawOver()}}Object.defineProperty(ScrollView.prototype,"isShowEvents",{get:function(){return this._isShowEvents},set:function(b){this._isShowEvents=b;this.sUpdata()},enumerable:true,configurable:true});Object.defineProperty(ScrollView.prototype,"handler",{get:function(){return this._eventHandler},set:function(h){this._eventHandler=h;h.target=this},enumerable:true,configurable:true});ScrollView.prototype.removeListBtn=function(){if(this._listButton.parent){this._listButton.parent.removeChild(this._listButton)}};Object.defineProperty(ScrollView.prototype,"bgSRC",{set:function(src){this._bg.src=src},enumerable:true,configurable:true});Object.defineProperty(ScrollView.prototype,"scrollbgSRC",{set:function(src){this._scroll_bg.src=src},enumerable:true,configurable:true});Object.defineProperty(ScrollView.prototype,"scrollPressbgSRC",{set:function(src){this._scroll_bg_press.src=src},enumerable:true,configurable:true});Object.defineProperty(ScrollView.prototype,"fakeWidth",{get:function(){return this.width-ScrollView.SCROLL_WIDTH},enumerable:true,configurable:true});Object.defineProperty(ScrollView.prototype,"scale",{get:function(){return this._scale},set:function(scale){var s=scale<0?0:scale>1?1:scale;this._scale=s;this._scrollButton.left=s*this.fakeWidth;this.sUpdata();if(this.scaleChangeAction){this.scaleChangeAction(this._scale)}},enumerable:true,configurable:true});ScrollView.prototype.onCreate=function(w){this.width=w;this._scrollButton.left=this._scale*w;this.sUpdata()};ScrollView.SCROLL_EVENTS_TYPE_LINE=0;ScrollView.SCROLL_EVENTS_TYPE_RECT=1;ScrollView.SCROLL_WIDTH=35;return ScrollView}(view.Container);widget.ScrollView=ScrollView;var ListButton=function(_super){__extends(ListButton,_super);function ListButton(handler){_super.call(this);this._handler=handler;this.layout=new EasyLayout(this);this.initHW();this.onCreate()}Object.defineProperty(ListButton.prototype,"handler",{get:function(){return this._handler},enumerable:true,configurable:true});ListButton.prototype.initHW=function(){this.height=this._handler.getMaxNum()*this._handler.getBtnHight();this.width=this._handler.getBtnWidth()};ListButton.prototype.onCreate=function(){this.cleanChildren();for(var i=0;i<this._handler.getMaxNum();i++){var btn=this._handler.getBtn(i);btn.width=this._handler.getBtnWidth();btn.height=this._handler.getBtnHight();this.addChild(btn)}this.layout.maxHeight=0;this.upDataLayout()};return ListButton}(view.Container);widget.ListButton=ListButton;var Button=function(_super){__extends(Button,_super);function Button(){var _this=this;_super.call(this);this._txt="Button";this._txtColor="black";this._txtFont=14;this._pen=new iPen(this.canvas);this.width=60;this.height=30;this._btn_bg=new Image;this._btn_bg.src="src/lib/img/btn.png";this._btn_bg_press=new Image;this._btn_bg_press.src="src/lib/img/btn_press.png";this.setBackGround(this._btn_bg);this.onDraw=function(ctx){_this._pen.readDraw(_this._txtColor,1);ctx.font=_this._txtFont+"px SimHei";var w=ctx.measureText(_this._txt).width;var x=(_this.width-w)/2-2;x=x>0?x:0;ctx.fillStyle=_this._txtColor;ctx.fillText(_this._txt,x,_this.height/2+_this._txtFont/4,_this.width);_this._pen.drawOver()};this.addTouchEventListener(function(e){switch(e.touchType){case view.View.DOWN:_this.setBackGround(_this._btn_bg_press);break;case view.View.UP:_this.setBackGround(_this._btn_bg);if(_this._clickFun&&e.target==_this.parent.canvas&&e.offX>_this.left&&e.offX<_this.right&&e.offY>_this.top&&e.offY<_this.bottom){_this._clickFun()}break;default:break}return true})}Object.defineProperty(Button.prototype,"txt",{get:function(){return this._txt},set:function(s){this._txt=s;this.sUpdata()},enumerable:true,configurable:true});Object.defineProperty(Button.prototype,"txtColor",{get:function(){return this._txtColor},set:function(s){this._txtColor=s;this.sUpdata()},enumerable:true,configurable:true});Object.defineProperty(Button.prototype,"txtFont",{get:function(){return this._txtFont},set:function(n){this._txtFont=n;this.sUpdata()},enumerable:true,configurable:true});Button.prototype.addClickEvent=function(fun){this._clickFun=fun};return Button}(view.View);widget.Button=Button})(widget||(widget={}));
