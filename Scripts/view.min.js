var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var view;(function(view){var Activity=function(){function Activity(c){this._lastTime=0;this._canvas=c;this._timers=new Array;this._ctx=c.getContext("2d");this._children=new Array;this.init()}Object.defineProperty(Activity.prototype,"children",{get:function(){return this._children},enumerable:true,configurable:true});Object.defineProperty(Activity.prototype,"layout",{get:function(){return this._layout},set:function(l){this._layout=l},enumerable:true,configurable:true});Object.defineProperty(Activity.prototype,"width",{get:function(){return this._canvas.width},enumerable:true,configurable:true});Object.defineProperty(Activity.prototype,"height",{get:function(){return this._canvas.height},enumerable:true,configurable:true});Object.defineProperty(Activity.prototype,"canvas",{get:function(){return this._canvas},enumerable:true,configurable:true});Activity.prototype.upDataLayout=function(){if(this._layout){this.layout.useLayout()}};Activity.prototype.sUpdataViews=function(clazzs){A:for(var x=0;x<this._children.length;x++){for(var y=0;y<clazzs.length;y++){if(this._children[x].constructor==clazzs[y]){this._children[x].sUpdata();clazzs.splice(y,1);continue A}}}};Activity.prototype.removeChildrenByClass=function(clazzs){A:for(var x=0;x<this._children.length;x++){for(var y=0;y<clazzs.length;y++){if(this._children[x].constructor==clazzs[y]){this._children.splice(x,1);x--;continue A}}}};Activity.prototype.hasID=function(v){for(var i=0;i<this._children.length;i++){if(v.id&&v.id==this._children[i].id){console.log(v.id+"已经被使用");return true}}return false};Activity.prototype.getViewByID=function(id){for(var i=0;i<this._children.length;i++){if(id&&id==this._children[i].id){return this._children[i]}}};Activity.prototype.addChild=function(v){if(!this.hasID(v)&&v.addParent(this)){this._children.push(v);v.nowType=view.ViewType.CHANGE;return true}return false};Object.defineProperty(Activity.prototype,"maxIndex",{get:function(){return this._children.length-1},enumerable:true,configurable:true});Activity.prototype.changeChildIndex=function(nowIndex,newIndex){var index=newIndex;if(index<0){index=0}else if(index>=this._children.length){index=this._children.length-1}var child=this._children.splice(nowIndex,1);this._children.splice(index,0,child[0])};Activity.prototype.getChildIndex=function(v){for(var i=0;i<this._children.length;i++){if(v==this._children[i]){return i}}return-1};Activity.prototype.removeChild=function(v){if(v.parent)for(var i=0;i<this._children.length;i++){if(this._children[i]==v){var child=this._children.splice(i,1);child[0].removeParent()}}};Activity.prototype.addTimer=function(timer){this._timers.push(timer)};Activity.prototype.cleanTimer=function(){this._timers.splice(0,this._timers.length)};Activity.prototype.init=function(){this.initEvent();this.run(this)};Activity.prototype.run=function(a){var _this=this;a._ctx.clearRect(0,0,a._canvas.width,a._canvas.height);for(var i=0;i<a._children.length;i++){var child=a._children[i];if(child.nowType==ViewType.CHANGE){if(child instanceof Container){child.contianerDraw(child.canvas.getContext("2d"))}else{child.draw(child.canvas.getContext("2d"))}}this._ctx.drawImage(child.canvas,child.left,child.top)}requestAnimationFrame(function(rt){var dt=rt-_this._lastTime;_this._lastTime=rt;for(var i=0;i<_this._timers.length;i++){_this._timers[i](dt)}a.run(a)})};Activity.prototype.initEvent=function(){var _this=this;window.ondragstart=function(){return false};window.addEventListener("mousewheel",function(e){if(e.target==_this._canvas){for(var i=_this._children.length-1;i>=0;i--){var child=_this._children[i];if(e.offsetX>child.left&&e.offsetX<child.right&&e.offsetY>child.top&&e.offsetY<child.bottom){if(_this._children[i].onMouseWheelEvent(e)){break}}}}});window.addEventListener(view.View.MOUSE_DOWN,function(e){e.offX=e.offsetX;e.offY=e.offsetY;switch(e.type){case view.View.MOUSE_DOWN:case view.View.TOUCH_DOWN:e.touchType=view.View.DOWN;break;case view.View.MOUSE_MOVE:case view.View.TOUCH_MOVE:e.touchType=view.View.MOVE;break;case view.View.MOUSE_UP:case view.View.TOUCH_UP:e.touchType=view.View.UP;break}if(e.target==_this._canvas)for(var i=_this._children.length-1;i>=0;i--){var child=_this._children[i];if(e.offsetX>child.left&&e.offsetX<child.right&&e.offsetY>child.top&&e.offsetY<child.bottom){if(child instanceof Container){if(child.issue(e)){_this._activityView=child;return}else{continue}}else{if(child.onTouchEvent(e)){_this._activityView=child;return}}}}});window.addEventListener(view.View.TOUCH_DOWN,function(e){if(_this.gesture){_this.gesture(e)}e.clientX=e.changedTouches[0].clientX+document.body.scrollLeft;e.clientY=e.changedTouches[0].clientY+document.body.scrollTop;e.offX=e.clientX-_this.canvas.offsetLeft;e.offY=e.clientY-_this.canvas.offsetTop;e.offsetX=e.offX;e.offsetY=e.offY;switch(e.type){case view.View.MOUSE_DOWN:case view.View.TOUCH_DOWN:e.touchType=view.View.DOWN;break;case view.View.MOUSE_MOVE:case view.View.TOUCH_MOVE:e.touchType=View.MOVE;break;case view.View.MOUSE_UP:case view.View.TOUCH_UP:e.touchType=view.View.UP;break}if(e.target==_this._canvas){e.preventDefault();for(var i=_this._children.length-1;i>=0;i--){var child=_this._children[i];if(e.offsetX>child.left&&e.offsetX<child.right&&e.offsetY>child.top&&e.offsetY<child.bottom){if(child instanceof Container){if(child.issue(e)){_this._activityView=child;return}else{continue}}else{if(child.onTouchEvent(e)){_this._activityView=child;return}}}}}});window.addEventListener(View.MOUSE_MOVE,function(e){e.offX=e.offsetX;e.offY=e.offsetY;switch(e.type){case View.MOUSE_DOWN:case View.TOUCH_DOWN:e.touchType=View.DOWN;break;case View.MOUSE_MOVE:case View.TOUCH_MOVE:e.touchType=View.MOVE;break;case View.MOUSE_UP:case View.TOUCH_UP:e.touchType=View.UP;break}if(_this._activityView){if(_this._activityView instanceof Container){_this._activityView.issue(e);return}_this._activityView.onTouchEvent(e);return}if(e.target==_this._canvas){for(var i=_this._children.length-1;i>=0;i--){var child=_this._children[i];if(e.offsetX>child.left&&e.offsetX<child.right&&e.offsetY>child.top&&e.offsetY<child.bottom){if(child.onFloatEvent(e)){break}else{child=null}}else{child=null}}if(_this._lastFloatView!=child){if(_this._lastFloatView){e.touchType=View.FLOAT_END;_this._lastFloatView.onFloatEvent(e);_this._lastFloatView=null}if(child){_this._lastFloatView=child}}}});window.addEventListener(view.View.TOUCH_MOVE,function(e){if(_this.gesture){_this.gesture(e)}e.clientX=e.changedTouches[0].clientX+document.body.scrollLeft;e.clientY=e.changedTouches[0].clientY+document.body.scrollTop;e.offX=e.clientX-_this.canvas.offsetLeft;e.offY=e.clientY-_this.canvas.offsetTop;e.offsetX=e.offX;e.offsetY=e.offY;switch(e.type){case view.View.MOUSE_DOWN:case view.View.TOUCH_DOWN:e.touchType=view.View.DOWN;break;case view.View.MOUSE_MOVE:case view.View.TOUCH_MOVE:e.touchType=view.View.MOVE;break;case view.View.MOUSE_UP:case view.View.TOUCH_UP:e.touchType=view.View.UP;break}if(_this._activityView){e.preventDefault();if(_this._activityView instanceof Container){_this._activityView.issue(e)}else{_this._activityView.onTouchEvent(e)}}});window.addEventListener(view.View.MOUSE_UP,function(e){e.offX=e.offsetX;e.offY=e.offsetY;switch(e.type){case view.View.MOUSE_DOWN:case view.View.TOUCH_DOWN:e.touchType=view.View.DOWN;break;case view.View.MOUSE_MOVE:case view.View.TOUCH_MOVE:e.touchType=view.View.MOVE;break;case view.View.MOUSE_UP:case view.View.TOUCH_UP:e.touchType=view.View.UP;break}if(_this._activityView){if(_this._activityView instanceof Container){_this._activityView.issue(e);_this._activityView.cleanAction()}else{_this._activityView.onTouchEvent(e)}_this._activityView=null}});window.addEventListener(view.View.TOUCH_UP,function(e){if(_this.gesture){_this.gesture(e)}e.clientX=e.changedTouches[0].clientX+document.body.scrollLeft;e.clientY=e.changedTouches[0].clientY+document.body.scrollTop;e.offX=e.clientX-_this.canvas.offsetLeft;e.offY=e.clientY-_this.canvas.offsetTop;e.offsetX=e.offX;e.offsetY=e.offY;switch(e.type){case view.View.MOUSE_DOWN:case view.View.TOUCH_DOWN:e.touchType=view.View.DOWN;break;case view.View.MOUSE_MOVE:case view.View.TOUCH_MOVE:e.touchType=view.View.MOVE;break;case view.View.MOUSE_UP:case view.View.TOUCH_UP:e.touchType=view.View.UP;break}if(_this._activityView){e.preventDefault();if(_this._activityView instanceof Container){_this._activityView.issue(e);_this._activityView.cleanAction()}else{_this._activityView.onTouchEvent(e)}_this._activityView=null}})};return Activity}();view.Activity=Activity;(function(ViewType){ViewType[ViewType["CHANGE"]=0]="CHANGE";ViewType[ViewType["SUCCESS"]=1]="SUCCESS"})(view.ViewType||(view.ViewType={}));var ViewType=view.ViewType;var View=function(){function View(){this.ignoreLayout=false;this._id=null;this._alpha=1;this.init()}Object.defineProperty(View,"DOWN",{get:function(){return"down"},enumerable:true,configurable:true});Object.defineProperty(View,"MOVE",{get:function(){return"move"},enumerable:true,configurable:true});Object.defineProperty(View,"UP",{get:function(){return"up"},enumerable:true,configurable:true});Object.defineProperty(View,"TOUCH_DOWN",{get:function(){return"touchstart"},enumerable:true,configurable:true});Object.defineProperty(View,"TOUCH_MOVE",{get:function(){return"touchmove"},enumerable:true,configurable:true});Object.defineProperty(View,"TOUCH_UP",{get:function(){return"touchend"},enumerable:true,configurable:true});Object.defineProperty(View,"MOUSE_DOWN",{get:function(){return"mousedown"},enumerable:true,configurable:true});Object.defineProperty(View,"MOUSE_MOVE",{get:function(){return"mousemove"},enumerable:true,configurable:true});Object.defineProperty(View,"MOUSE_UP",{get:function(){return"mouseup"},enumerable:true,configurable:true});Object.defineProperty(View,"FLOAT_MOVE",{get:function(){return"mousemove"},enumerable:true,configurable:true});Object.defineProperty(View,"FLOAT_END",{get:function(){return"end"},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"id",{get:function(){return this._id},set:function(id){this._id=id},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"alpha",{get:function(){return this._alpha},set:function(a){this._alpha=a;this.sUpdata()},enumerable:true,configurable:true});View.prototype.setBackGround=function(i){this._img=i;this.sUpdata()};View.prototype.getIndexForParents=function(){if(this.parent){return this.parent.getChildIndex(this)}return-1};View.prototype.changeIndexForParents=function(newIndex){if(this.parent){var now=this.parent.getChildIndex(this);this.parent.changeChildIndex(now,newIndex)}};Object.defineProperty(View.prototype,"right",{get:function(){return this.left+this.width},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"bottom",{get:function(){return this.top+this.height},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"ctx",{get:function(){return this._ctx},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"canvas",{get:function(){return this._canvas},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"parent",{get:function(){if(this.container){return this.container.parent}return this._parent},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"container",{get:function(){return this._container},enumerable:true,configurable:true});View.prototype.addParent=function(a){if(!this._parent){this._parent=a;return true}return false};View.prototype.addContainer=function(c){if(!this._container){this._container=c;return true}return false};View.prototype.removeParent=function(){this._parent=null;this._container=null};Object.defineProperty(View.prototype,"width",{get:function(){return this._canvas.width},set:function(w){this._canvas.width=w},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"height",{get:function(){return this._canvas.height},set:function(h){this._canvas.height=h},enumerable:true,configurable:true});Object.defineProperty(View.prototype,"nowType",{get:function(){return this._nowType},set:function(vt){if(this._container&&vt==view.ViewType.CHANGE){this._container.nowType=view.ViewType.CHANGE}this._nowType=vt},enumerable:true,configurable:true});View.prototype.init=function(){this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this.left=0;this.top=0};View.prototype.removeEventListener=function(s){switch(s){case"touch":this._touchListener=null;break;case"float":this._floatMoveListener=null;break;case"mouseWheel":this._mouseWheelListener=null;break}};View.prototype.addTouchEventListener=function(listener){this._touchListener=listener};View.prototype.addFloatMoveEvent=function(listener){this._floatMoveListener=listener};View.prototype.addMouseWheelEventListener=function(listener){this._mouseWheelListener=listener};View.prototype.onTouchEvent=function(e){if(this._touchListener)return this._touchListener(e);else return false};View.prototype.onFloatEvent=function(e){if(this._floatMoveListener)return this._floatMoveListener(e);else return false};View.prototype.onMouseWheelEvent=function(e){if(this._mouseWheelListener){return this._mouseWheelListener(e)}else{return false}};View.prototype.sUpdata=function(){this.nowType=ViewType.CHANGE};View.prototype.draw=function(ctx){ctx.clearRect(0,0,this.width,this.height);ctx.globalAlpha=this.alpha;if(this._img){if(this._img.complete){ctx.drawImage(this._img,0,0,this.width,this.height)}else{this.nowType=view.ViewType.CHANGE;return}}if(this.onDraw)this.onDraw(ctx);this.nowType=view.ViewType.SUCCESS};return View}();view.View=View;var Container=function(_super){__extends(Container,_super);function Container(){_super.call(this);this._children=new Array}Container.prototype.removeChildrenByClass=function(clazzs){A:for(var x=0;x<this._children.length;x++){for(var y=0;y<clazzs.length;y++){if(this._children[x].constructor==clazzs[y]){this._children.splice(x,1);x--;continue A}}}};Object.defineProperty(Container.prototype,"layout",{get:function(){return this._layout},set:function(l){this._layout=l},enumerable:true,configurable:true});Container.prototype.upDataLayout=function(){if(this._layout){this._layout.useLayout()}};Object.defineProperty(Container.prototype,"children",{get:function(){return this._children},enumerable:true,configurable:true});Container.prototype.contianerDraw=function(ctx){this.draw(ctx);for(var i=0;i<this._children.length;i++){var child=this._children[i];if(child.nowType==ViewType.CHANGE){if(child instanceof Container){child.contianerDraw(child.canvas.getContext("2d"))}else{child.draw(child.canvas.getContext("2d"))}}this.ctx.drawImage(child.canvas,child.left,child.top)}};Container.prototype.cleanChildren=function(){this._children.splice(0,this._children.length)};Container.prototype.hasID=function(v){for(var i=0;i<this._children.length;i++){if(v.id&&v.id==this._children[i].id){return true}}return false};Container.prototype.getViewByID=function(id){for(var i=0;i<this._children.length;i++){if(id&&id==this._children[i].id){return this._children[i]}}};Container.prototype.addChild=function(v){if(!this.hasID(v)&&v.addParent(this.parent)&&v.addContainer(this)){this._children.push(v);v.nowType=view.ViewType.CHANGE;this.nowType=view.ViewType.CHANGE;return true}return false};Object.defineProperty(Container.prototype,"maxIndex",{get:function(){var index=this._children.length-1;if(index>0){return this._children.length-1}else{return 0}},enumerable:true,configurable:true});Container.prototype.changeChildIndex=function(nowIndex,newIndex){var index=newIndex;if(index<0){index=0}else if(index>=this._children.length){index=this._children.length-1}var child=this._children.splice(nowIndex,1);this._children.splice(index,0,child[0])};Container.prototype.getChildIndex=function(v){for(var i=0;i<this._children.length;i++){if(v==this._children[i]){return i}}return-1};Container.prototype.removeChild=function(v){if(v.parent)for(var i=0;i<this._children.length;i++){if(this._children[i]==v){var child=this._children.splice(i,1);child[0].removeParent()}}this.nowType=view.ViewType.CHANGE};Container.prototype.sUpdataViews=function(clazzs){A:for(var x=0;x<this._children.length;x++){for(var y=0;y<clazzs.length;y++){if(this._children[x].constructor==clazzs[y]){this._children[x].sUpdata();clazzs.splice(y,1);continue A}}}};Container.prototype.cleanAction=function(){if(this._actionChild instanceof Container){if(this._actionChild==this){}else{this._actionChild.cleanAction()}}this._actionChild=null};Container.prototype.issue=function(e){e.offX-=this.left;e.offY-=this.top;if(this._actionChild){if(this._actionChild instanceof Container){if(this._actionChild==this){e.offX+=this.left;e.offY+=this.top;return this.onTouchEvent(e)}return this._actionChild.issue(e)}else{return this._actionChild.onTouchEvent(e)}}for(var i=this._children.length-1;i>=0;i--){var child=this._children[i];if(e.offX>child.left&&e.offX<child.right&&e.offY>child.top&&e.offY<child.bottom){if(child instanceof Container){if(child.issue(e)){this._actionChild=child;return true}else{continue}}else{if(child.onTouchEvent(e)){this._actionChild=child;return true}else{continue}}}}e.offX+=this.left;e.offY+=this.top;if(this.onTouchEvent(e)){this._actionChild=this;return true}return false};return Container}(View);view.Container=Container})(view||(view={}));var animations;(function(animations){var Trans=function(){function Trans(){this.runTime=0}Trans.prototype.play=function(v,startX,endX,startY,endY,time){if(this.runTime==0){var offX=endX-startX;var offY=endY-startY;var sX=offX/(time/10);var sY=offY/(time/10);v.left=startX;v.top=startY;this.run(sX,sY,v,offX,endX,endY,time)}};Trans.prototype.run=function(sX,sY,v,offX,endX,endY,time){var _this=this;setTimeout(function(){v.top+=sY;v.left+=sX;_this.runTime+=10;if(_this.runTime>=time){v.top=endY;v.left=endX;_this.runTime=0;if(_this.over){_this.over(v)}return}_this.run(sX,sY,v,offX,endX,endY,time)},10)};return Trans}();animations.Trans=Trans;var Alpha=function(){function Alpha(){this.runTime=0}Alpha.prototype.play=function(v,start,end,time){if(this.runTime==0){var off=end-start;var speed=off/(time/10);v.alpha=start;this.run(speed,v,off,end)}};Alpha.prototype.run=function(speed,v,off,end){var _this=this;setTimeout(function(){v.alpha+=speed;_this.runTime+=speed;if(Math.abs(_this.runTime)>=Math.abs(off)){v.alpha=end;_this.runTime=0;if(_this.over){_this.over(v)}return}_this.run(speed,v,off,end)},10)};return Alpha}();animations.Alpha=Alpha})(animations||(animations={}));
