var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var main;var table;var flag;var map;window.onload=function(){main=new Main($("canvas").get(0));flag=new Flag;table=new Table;main.addChild(table);map=new GameMap;main.addChild(map);table.top=table.left=40;map.top=map.left=40};var Flag=function(_super){__extends(Flag,_super);function Flag(){_super.call(this);this.mType=Table.WHITE;this.pen=new iPen(this.canvas);this.onCreate()}Object.defineProperty(Flag.prototype,"mType",{get:function(){return this._mType},set:function(t){var str="Now："+(t==Table.BLACK?"Black":"White");$("#showTxt").html(str);this._mType=t},enumerable:true,configurable:true});Flag.prototype.onCreate=function(){var _this=this;this.width=Table.CELL_TABLE-4;this.height=Table.CELL_TABLE-4;this.onDraw=function(ctx){_this.ctx.clearRect(0,0,_this.width,_this.height);var heart=_this.width/2;var grad=ctx.createRadialGradient(heart,heart,heart/10,heart,heart,heart);grad.addColorStop(0,"rgba(100, 100, 100, 0.8)");grad.addColorStop(.5,"rgba(50, 50, 50, 0.8)");grad.addColorStop(1,"rgba(0, 0, 0, 0.8)");switch(_this.mType){case Table.WHITE:grad=ctx.createRadialGradient(heart,heart,heart/10,heart,heart,heart);grad.addColorStop(0,"rgba(200, 200, 200, 0.8)");grad.addColorStop(.5,"rgba(220, 220, 220, 0.8)");grad.addColorStop(1,"rgba(255, 255, 255, 0.8)");break}ctx.beginPath();ctx.fillStyle=grad;ctx.arc(_this.width/2,_this.height/2,_this.width/2,0,Math.PI*2,true);ctx.closePath();_this.ctx.fill();_this.nowType=view.ViewType.SUCCESS};this.nowType=view.ViewType.CHANGE};return Flag}(view.View);var Main=function(_super){__extends(Main,_super);function Main(c){_super.call(this,c)}return Main}(view.Activity);var GameMap=function(_super){__extends(GameMap,_super);function GameMap(){_super.call(this);this.pen=new iPen(this.canvas);this.width=Table.WIDTH_TABLE;this.height=Table.WIDTH_TABLE;this.onCreate()}GameMap.prototype.onCreate=function(){var _this=this;this.onDraw=function(ctx){ctx.clearRect(0,0,_this.width,_this.height);var num=Table.WIDTH_TABLE/Table.CELL_TABLE+1;for(var x=0;x<num;x++){for(var y=0;y<num;y++){var value=table.arr[x][y];if(value==Table.NULL){continue}var color=value==Table.BLACK?"black":"white";ctx.beginPath();ctx.fillStyle=color;ctx.arc(x*Table.CELL_TABLE,y*Table.CELL_TABLE,flag.width/2,0,Math.PI*2,true);ctx.closePath();_this.ctx.fill()}}_this.nowType=view.ViewType.SUCCESS}};return GameMap}(view.View);var Table=function(_super){__extends(Table,_super);function Table(){_super.call(this);this.pen=new iPen(this.canvas);this.width=Table.WIDTH_TABLE;this.height=Table.WIDTH_TABLE;this.onCreate()}Object.defineProperty(Table,"BLACK",{get:function(){return 1},enumerable:true,configurable:true});Object.defineProperty(Table,"WHITE",{get:function(){return 2},enumerable:true,configurable:true});Object.defineProperty(Table,"NULL",{get:function(){return 0},enumerable:true,configurable:true});Object.defineProperty(Table,"CELL_TABLE",{get:function(){return 30},enumerable:true,configurable:true});Object.defineProperty(Table,"WIDTH_TABLE",{get:function(){return 420},enumerable:true,configurable:true});Table.prototype.cleanTable=function(){this.arr=new Array;flag.mType=Table.BLACK;this.whiteNumber=0;this.blackNumber=0;var num=Table.WIDTH_TABLE/Table.CELL_TABLE+1;for(var x=0;x<num;x++){this.arr[x]=new Array;for(var y=0;y<num;y++){this.arr[x][y]=Table.NULL}}};Table.prototype.choiceWhere=function(left,top){var arr=new Array;var num=Table.WIDTH_TABLE/Table.CELL_TABLE+1;var x=-1;var y=-1;for(var i=0;i<num;i++){if(i*Table.CELL_TABLE>left-40&&i*Table.CELL_TABLE<left+flag.width-40){x=i;break}}for(i=0;i<num;i++){if(i*Table.CELL_TABLE>top-40&&i*Table.CELL_TABLE<top+flag.height-40){y=i;break}}if(x==-1||y==-1){return null}arr[0]=x;arr[1]=y;return arr};Table.prototype.showArr=function(){var num=Table.WIDTH_TABLE/Table.CELL_TABLE+1;for(var x=0;x<num;x++){var str="";for(var y=0;y<num;y++){str+=this.arr[y][x]+","}console.log(x+"|"+str)}};Table.prototype.win=function(x,y){var num=Table.WIDTH_TABLE/Table.CELL_TABLE;for(var i=1;i<5;i++){if(x-i<0){break}if(!(this.arr[x][y]==this.arr[x-i][y])){break}if(i==4){return true}}for(i=1;i<5;i++){if(x+i>num){break}if(!(this.arr[x][y]==this.arr[x+i][y])){break}if(i==4){return true}}for(i=1;i<5;i++){if(y-i<0){break}if(!(this.arr[x][y]==this.arr[x][y-i])){break}if(i==4){return true}}for(i=1;i<5;i++){if(y+i>num){break}if(!(this.arr[x][y]==this.arr[x][y+i])){break}if(i==4){return true}}for(i=1;i<5;i++){if(y-i<0||x-i<0){break}if(!(this.arr[x][y]==this.arr[x-i][y-i])){break}if(i==4){return true}}for(i=1;i<5;i++){if(y+i>num||x+i>num){break}if(!(this.arr[x][y]==this.arr[x+i][y+i])){break}if(i==4){return true}}for(i=1;i<5;i++){if(y-i<0||x+i>num){break}if(!(this.arr[x][y]==this.arr[x+i][y-i])){break}if(i==4){return true}}for(i=1;i<5;i++){if(y+i>num||x-i<0){break}if(!(this.arr[x][y]==this.arr[x-i][y+i])){break}if(i==4){return true}}return false};Table.prototype.onCreate=function(){var _this=this;this.cleanTable();this.onDraw=function(ctx){if(_this.parent){_this.pen.readDraw("black",1);var y=-Table.CELL_TABLE;while(y<Table.WIDTH_TABLE){y+=Table.CELL_TABLE;ctx.moveTo(0,y);ctx.lineTo(Table.WIDTH_TABLE,y)}_this.pen.drawOver();_this.pen.readDraw("black",1);var x=-Table.CELL_TABLE;while(x<Table.WIDTH_TABLE){x+=Table.CELL_TABLE;ctx.moveTo(x,0);ctx.lineTo(x,Table.WIDTH_TABLE)}var min=2;var max=Table.WIDTH_TABLE/Table.CELL_TABLE-min;_this.pen.drawOver();var p1=min*Table.CELL_TABLE;var p2=max*Table.CELL_TABLE;var p3=(max/2+1)*Table.CELL_TABLE;ctx.beginPath();ctx.arc(p1,p1,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p3,p1,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p3,p2,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p1,p2,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p2,p2,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p2,p1,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p1,p3,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p2,p3,2,0,Math.PI*2,true);_this.pen.drawOver();ctx.beginPath();ctx.arc(p3,p3,2,0,Math.PI*2,true);_this.pen.drawOver();_this.nowType=view.ViewType.SUCCESS}};var offX=0;var offY=0;this.addTouchEventListener(function(e){switch(e.type){case view.View.MOUSE_DOWN:case view.View.TOUCH_DOWN:var l=e.offsetX-flag.width/2;var t=e.offsetY-flag.height/2;var arr=_this.choiceWhere(l,t);if(arr&&_this.arr[arr[0]][arr[1]]!=Table.NULL){flag.mType=_this.arr[arr[0]][arr[1]];if(flag.mType==Table.BLACK){_this.blackNumber--}else{_this.whiteNumber--}_this.arr[arr[0]][arr[1]]=Table.NULL;map.nowType=view.ViewType.CHANGE}_this.parent.addChild(flag);flag.left=e.offsetX-flag.width/2;flag.top=e.offsetY-flag.height/2;offX=flag.left-e.offsetX;offY=flag.top-e.offsetY;flag.nowType=view.ViewType.CHANGE;break;case view.View.MOUSE_MOVE:case view.View.TOUCH_MOVE:flag.left=offX+e.offsetX;flag.top=offY+e.offsetY;break;case view.View.MOUSE_UP:case view.View.TOUCH_UP:if(flag.parent){var arr=_this.choiceWhere(flag.left,flag.top);if(arr)if(_this.arr[arr[0]][arr[1]]==Table.NULL){_this.arr[arr[0]][arr[1]]=flag.mType;var who=flag.mType==Table.BLACK?"Black":"White";if(flag.mType==Table.BLACK){_this.blackNumber++}else{_this.whiteNumber++}if(_this.blackNumber==_this.whiteNumber||_this.blackNumber<_this.whiteNumber){flag.mType=Table.BLACK}else if(_this.blackNumber>_this.whiteNumber){flag.mType=Table.WHITE}map.nowType=view.ViewType.CHANGE;if(_this.win(arr[0],arr[1])){alert(who+" win！");_this.cleanTable()}}flag.parent.removeChild(flag)}break}return true});this.nowType=view.ViewType.CHANGE};return Table}(view.View);
